import cv2
import numpy as np
import torch
from PIL import Image, ImageDraw, ImageFont

from models.experimental import attempt_load
from utils.general import non_max_suppression

#======================================================一些參數
WEIGHTS = "bestv7.pt"
DEVICE = "cpu"
IMAGE_SIZE = 640
CLASSES=['c000085', 'c000086', 'c000753', 'c001096', 'c001162', 'c001163', 'c001369', 'c001371', 'c001372', 'c001648', 'c002087', 'c002095', 'c002097', 'c002110', 'c002112', 'c002114', 'c002126', 'c002156', 'c002160', 'c002164', 'c002242', 'c002249', 'c002518', 'c002973', 'c003157', 'c003170', 'c004370', 'c004397', 'c004553', 'c004554', 'c004555', 'c005333', 'c006682', 'c006700', 'c007318', 'c007712', 'c008194', 'c008416', 'c009000', 'c009276', 'c009379', 'c009861', 'c010177', 'c010237', 'c010300', 'c010572', 'c010741', 'c010973', 'c011439', 'c011441', 'c011479', 'c011487', 'c012133', 'c012134', 'c012136', 'c012137', 'c012138', 'c012266', 'c012267', 'c012613', 'c012666', 'c012674', 'c012699', 'c013026', 'c013031', 'c013032', 'c013228', 'c013231', 'c013243', 'c013306', 'c013924', 'c013942', 'c013996', 'c014312', 'c014610', 'c014829', 'c014830', 'c014955', 'c015498', 'c016033', 'c016417', 'c016688', 'c017196', 'c017318', 'c017320', 'c017405', 'c018055', 'c018098', 'c018128', 'c018140', 'c018241', 'c018331', 'c018503', 'c019079', 'c019261', 'c019534', 'c019791', 'c019819', 'c019938', 'c020059', 'c020100', 'c020646', 'c021104', 'c021182', 'c021655', 'c022100', 'c022198', 'c022218', 'c022287', 'c022623', 'c022982', 'c023438', 'c023949', 'c024314', 'c024319', 'c024460', 'c024477', 'c024480', 'c024553', 'c024578', 'c024670', 'c024777', 'c024873', 'c024933', 'c025050', 'c025082', 'c025184', 'c025206', 'c025744', 'c025900', 'c025909', 'c026218', 'c026250', 'c026286', 'c026678', 'c026909', 'c027593', 'c028928', 'c028990', 'c029362', 'c029379', 'c029560', 'c029566', 'c029570', 'c029615', 'c029642', 'c029780', 'c029900', 'c030711', 'c030712', 'c030785', 'c031098', 'c031326', 'c031348', 'c031364', 'c031571', 'c031626', 'c031767', 'c032226', 'c032228', 'c032284', 'c032460', 'c033200', 'c033467', 'c033597', 'c033769', 'c033954', 'c033980', 'c034625', 'c035180', 'c035199', 'c035236', 'c035269', 'c035650', 'c035654', 'c035697', 'c035708', 'c035711', 'c035719', 'c035720', 'c035742', 'c035848', 'c035904', 'c035973', 'c036270', 'c036442', 'c037434', 'c037447', 'c037573', 'c038337', 'c038406', 'c038729', 'c041633', 'c041695', 'c042111', 'c042128', 'c042311', 'c042801', 'c042806', 'c042861', 'c042922', 'c043075', 'c043280', 'c043689', 'c043894', 'c043912', 'c044164', 'c044306', 'c044601', 'c044743', 'c044756', 'c044780', 'c044803', 'c045261', 'c045362', 'c045403', 'c045410', 'c045552', 'c045755', 'c045908', 'c046361', 'c046409', 'c046476', 'c046537', 'c046540', 'c046640', 'c046893', 'c046922', 'c046925', 'c047603', 'c048116', 'c049341', 'c049475', 'c050036', 'c050694', 'c051521', 'c052348', 'c052871', 'c052878', 'c052947', 'c053093', 'c053932', 'c054250', 'c054415', 'c054588', 'c054690', 'c054692', 'c054914', 'c055268', 'c055351', 'c055443', 'c055544', 'c055699', 'c055950', 'c055962', 'c056534', 'c057768', 'c058045', 'c058202', 'c058283', 'c058369', 'c058438', 'c058592', 'c059937', 'c059954', 'c060173', 'c060174', 'c060175', 'c060176', 'c060177', 'c060178', 'c060179', 'c060180', 'c060181', 'c060182', 'c060183', 'c060184', 'c060186', 'c060187', 'c060192', 'c060193', 'c060194', 'c060195', 'c060199', 'c060200', 'c060201', 'c060202', 'c060203', 'c060204', 'c060205', 'c060206', 'c060211', 'c060223', 'c060406', 'c060419', 'c060555', 'c060624', 'c060681', 'c060908', 'c061258', 'c061776', 'c061923', 'c061981', 'c062806', 'c062973', 'c063149', 'c063604', 'c063734', 'c063912', 'c064144', 'c064278', 'c064425', 'c064428', 'c064603', 'c064716', 'c064787', 'c064949', 'c065241', 'c065336', 'c065618', 'c065675', 'c067203', 'c067205', 'c067206', 'c067207', 'c067447', 'c067521', 'c067640', 'c067642', 'c067643', 'c067646', 'c067647', 'c067648', 'c068575', 'c070124', 'c070207', 'c070212', 'c070230', 'c070333', 'c072252', 'c072266', 'c072758', 'c072929', 'c072967', 'c073306', 'c073311', 'c073329', 'c073342', 'c073373', 'c073374', 'c073430', 'c073433', 'c073434', 'c073482', 'c073490', 'c073491', 'c073511', 'c074586', 'c074916', 'c075110', 'c075195', 'c075643', 'c075845', 'c076445', 'c076446', 'c076476', 'c077714', 'c077947', 'c077948', 'c077949', 'c077950', 'c078172', 'c078217', 'c078752', 'c079014', 'c079358', 'c079390', 'c079927', 'c079977', 'c080536', 'c080892', 'c080924', 'c081088', 'c081264', 'c081533', 'c082245', 'c082927', 'c082966', 'c083936', 'c083983', 'c084244', 'c084847', 'c085856', 'c087556', 'c087575', 'c087815', 'c087817', 'c088628', 'c088639', 'c088892', 'c089063', 'c089064', 'c089266', 'c089451', 'c089630', 'c089765', 'c089767', 'c089824', 'c091240', 'c091644', 'c091647', 'c092258', 'c092922', 'c093354', 'c093355', 'c093368', 'c093592', 'c093614', 'c094528', 'c094672', 'c094915', 'c095310', 'c096153', 'c096310', 'c096429', 'c096597', 'c096617', 'c096852', 'c096945', 'c097336', 'c097373', 'c098612', 'c099391', 'c099562', 'c100502', 'c100613', 'c1019768', 'c102142', 'c102388', 'c102506', 'c102673', 'c102769', 'c102912', 'c103093', 'c103152', 'c103271', 'c103283', 'c103347', 'c103447', 'c103611', 'c103653', 'c103654', 'c103770', 'c103850', 'c104431', 'c104475', 'c104569', 'c105739', 'c105805', 'c105839', 'c106070', 'c107762', 'c107831', 'c108067', 'c108602', 'c110191', 'c110835', 'c110859', 'c111073', 'c111216', 'c111362', 'c111369', 'c111388', 'c111392', 'c111396', 'c111400', 'c111723', 'c111724', 'c111725', 'c111727', 'c111728', 'c111729', 'c111731', 'c111740', 'c111744', 'c111750', 'c111752', 'c111754', 'c111870', 'c111938', 'c112633', 'c112636', 'c113100', 'c113134', 'c113142', 'c113291', 'c113321', 'c113715', 'c114026', 'c114314', 'c114523', 'c115312', 'c115351', 'c115359', 'c115361', 'c115438', 'c116075', 'c117155', 'c117277', 'c117282', 'c117317', 'c117430', 'c117437', 'c117441', 'c117721', 'c118586', 'c119004', 'c119198', 'c119228', 'c119314', 'c119395', 'c119521', 'c119758', 'c119829', 'c120469', 'c120568', 'c120610', 'c120877', 'c121153', 'c121209', 'c121227', 'c121229', 'c121235', 'c121238', 'c121712', 'c121974', 'c121994', 'c122082', 'c122288', 'c122405', 'c122453', 'c122663', 'c122763', 'c122881', 'c122948', 'c123197', 'c123544', 'c123673', 'c124051', 'c124196', 'c124908', 'c125060', 'c125175', 'c125279', 'c125521', 'c125568', 'c125648', 'c125661', 'c125662', 'c125663', 'c125664', 'c125665', 'c126374', 'c126440', 'c126450', 'c126555', 'c126556', 'c126564', 'c126680', 'c126700', 'c126704', 'c126808', 'c126842', 'c126864', 'c126865', 'c127061', 'c127126', 'c127589', 'c127648', 'c127907', 'c127932', 'c128124', 'c128239', 'c129307', 'c129559', 'c129960', 'c130058', 'c131026', 'c131390', 'c131483', 'c131503', 'c131823', 'c131824', 'c132264', 'c132354', 'c132452', 'c132641', 'c132647', 'c132780', 'c133325', 'c133600', 'c133778', 'c134015', 'c134100', 'c134151', 'c134167', 'c134699', 'c134700', 'c134701', 'c134702', 'c134785', 'c135087', 'c135106', 'c135118', 'c135220', 'c135418', 'c135815', 'c135861', 'c135862', 'c135974', 'c136304', 'c136864', 'c136968', 'c137828', 'c138588', 'c139155', 'c139452', 'c139654', 'c139668', 'c139833', 'c139975', 'c140011', 'c140030', 'c140375', 'c140459', 'c140905', 'c141404', 'c141465', 'c141570', 'c141882', 'c142449', 'c144137', 'c144350', 'c144384', 'c145017', 'c145033', 'c145268', 'c146186', 'c146187', 'c146188', 'c146189', 'c146190', 'c146191', 'c146311', 'c146331', 'c146456', 'c146476', 'c146550', 'c146690', 'c146942', 'c147106', 'c147177', 'c147179', 'c147500', 'c148115', 'c148227', 'c148228', 'c148229', 'c148324', 'c148418', 'c149999', 'c150059', 'c150062', 'c150064', 'c150178', 'c150329', 'c150380', 'c150413', 'c150468', 'c150754', 'c150906', 'c151588', 'c151655', 'c151677', 'c151839', 'c152127', 'c152132', 'c152170', 'c152236', 'c152245', 'c152248', 'c152254', 'c152626', 'c153041', 'c153056', 'c153072', 'c153146', 'c153190', 'c153963', 'c153995', 'c154201', 'c154209', 'c154355', 'c154824', 'c155080', 'c155256', 'c155732', 'c155761', 'c155762', 'c155895', 'c155900', 'c155916', 'c155917', 'c155929', 'c155963', 'c155989', 'c156312', 'c156321', 'c156419', 'c157108', 'c157132', 'c157283', 'c157286', 'c157291', 'c157292', 'c157300', 'c157364', 'c157402', 'c157403', 'c157464', 'c157962', 'c158231', 'c158376', 'c158397', 'c158500', 'c158511', 'c158632', 'c158721', 'c158728', 'c159032', 'c159305', 'c159308', 'c159468', 'c160170', 'c160174', 'c160179', 'c160230', 'c160233', 'c160237', 'c160311', 'c160441', 'c160724', 'c160937', 'c160938', 'c160941', 'c160958', 'c160992', 'c160993', 'c161304', 'c161348', 'c161396', 'c161440', 'c161612', 'c161619', 'c161621', 'c161761', 'c161765', 'c161768', 'c161769', 'c161770', 'c161773', 'c161774', 'c161777', 'c161779', 'c161781', 'c161782', 'c161783', 'c161784', 'c161788', 'c161792', 'c161797', 'c161802', 'c161803', 'c161808', 'c161814', 'c161847', 'c162148', 'c162529', 'c162601', 'c162603', 'c162924', 'c162977', 'c162978', 'c163381', 'c163741', 'c163763', 'c163818', 'c163819', 'c163820', 'c163821', 'c163822', 'c163823', 'c163824', 'c163825', 'c163826', 'c163827', 'c163828', 'c163829', 'c163830', 'c163831', 'c163832', 'c163833', 'c163834', 'c163835', 'c163836', 'c163837', 'c163838', 'c163839', 'c163840', 'c163841', 'c163911', 'c164078', 'c164454', 'c164552', 'c164789', 'c164840', 'c164841', 'c164847', 'c165150', 'c165172', 'c165215', 'c165251', 'c165273', 'c165297', 'c165343', 'c165450', 'c165541', 'c165599', 'c165638', 'c165668', 'c165721', 'c165974', 'c166046', 'c166047', 'c166048', 'c166050', 'c166057', 'c166059', 'c166060', 'c166061', 'c166062', 'c166064', 'c166066', 'c166067', 'c166068', 'c166069', 'c166070', 'c166071', 'c166072', 'c166073', 'c166077', 'c166095', 'c166225', 'c166252', 'c166253', 'c166284', 'c166385', 'c166815', 'c166819', 'c166840', 'c166894', 'c166909', 'c167022', 'c167023', 'c167025', 'c167026', 'c167027', 'c167028', 'c167029', 'c167030', 'c167031', 'c167032', 'c167034', 'c167035', 'c167036', 'c167037', 'c167038', 'c167039', 'c167040', 'c167041', 'c167042', 'c167043', 'c167044', 'c167047', 'c167048', 'c167049', 'c167050', 'c167052', 'c167053', 'c167062', 'c167063', 'c167064', 'c167065', 'c167067', 'c167068', 'c167069', 'c167071', 'c167122', 'c167151', 'c167184', 'c167205', 'c167300', 'c167301', 'c167302', 'c167303', 'c167304', 'c167305', 'c167306', 'c167307', 'c167308', 'c167309', 'c167310', 'c167311', 'c167312', 'c167313', 'c167314', 'c167315', 'c167316', 'c167317', 'c167318', 'c167319', 'c167320', 'c167336', 'c167338', 'c167344', 'c167347', 'c167351', 'c167358', 'c167359', 'c167363', 'c167364', 'c167365', 'c167366', 'c167367', 'c167368', 'c167369', 'c167371', 'c167372', 'c167373', 'c167374', 'c167375', 'c167376', 'c167377', 'c167379', 'c167380', 'c167381', 'c167383', 'c167385', 'c167388', 'c167397', 'c167398', 'c167399', 'c167404', 'c167405', 'c167406', 'c167408', 'c167409', 'c167410', 'c167411', 'c167417', 'c167420', 'c167425', 'c167427', 'c167428', 'c167429', 'c167430', 'c167432', 'c167433', 'c167434', 'c167439', 'c167440', 'c167441', 'c167442', 'c167443', 'c167444', 'c167447', 'c167448', 'c167449', 'c167450', 'c167451', 'c167452', 'c167453', 'c167454', 'c167461', 'c167462', 'c167463', 'c167464', 'c167465', 'c167469', 'c167470', 'c167471', 'c167472', 'c167474', 'c167475', 'c167476', 'c167477', 'c167478', 'c167479', 'c167480', 'c167482', 'c167483', 'c167559', 'c167560', 'c167563', 'c167564', 'c167633', 'c167634', 'c167645', 'c167646', 'c167647', 'c167648', 'c167649', 'c167651', 'c167652', 'c167654', 'c167887', 'c168289', 'c168321', 'c168413', 'c168471', 'c168516', 'c168596', 'c168650', 'c168787', 'c169202', 'c169214', 'c169221', 'c169264', 'c169277', 'c169310', 'c169316', 'c169329', 'c169494', 'c169502', 'c169658', 'c169664', 'c169666', 'c169667', 'c169670', 'c169675', 'c169677', 'c169715', 'c169804', 'c169959', 'c169969', 'c169971', 'c169972', 'c170008', 'c170320', 'c170321', 'c170323', 'c170325', 'c170331', 'c170418', 'c170570', 'c170613', 'c170649', 'c170663', 'c170929', 'c171008', 'c171034', 'c171073', 'c171136', 'c171161', 'c171193', 'c171198', 'c171209', 'c171218', 'c171436', 'c171513', 'c171515', 'c171518', 'c171583', 'c171666', 'c171686', 'c171713', 'c171805', 'c171806', 'c171807', 'c171808', 'c171809', 'c171810', 'c171947', 'c172142', 'c172143', 'c172144', 'c172145', 'c172146', 'c172147', 'c172148', 'c172149', 'c172150', 'c172151', 'c172390', 'c172469', 'c172539', 'c172540', 'c172541', 'c172542', 'c172543', 'c172544', 'c172545', 'c172546', 'c172547', 'c172548', 'c172789', 'c172821', 'c172843', 'c172858', 'c172969', 'c172970', 'c172971', 'c172972', 'c172975', 'c172977', 'c172978', 'c172979', 'c172983', 'c173050', 'c173206', 'c173319', 'c173325', 'c173326', 'c173327', 'c173328', 'c173329', 'c173330', 'c173331', 'c173332', 'c173333', 'c173334', 'c173335', 'c173337', 'c173338', 'c173339', 'c173340', 'c173341', 'c173435', 'c173521', 'c173543', 'c173564', 'c173569', 'c173574', 'c173588', 'c173644', 'c173659', 'c173761', 'c173782', 'c173933', 'c174152', 'c174361', 'c174593', 'c174823', 'c175007', 'c175064', 'c175090', 'c175094', 'c175139', 'c175242', 'c175246', 'c175501', 'c175553', 'c175564', 'c175801', 'c175802', 'c175803', 'c175807', 'c175811', 'c175838', 'c175849', 'c175874', 'c175906', 'c175917', 'c175930', 'c175932', 'c175934', 'c175935', 'c175936', 'c175938', 'c175939', 'c175940', 'c175941', 'c175942', 'c175944', 'c175945', 'c175946', 'c175948', 'c175949', 'c175951', 'c175952', 'c175953', 'c175954', 'c175962', 'c175964', 'c175967', 'c175968', 'c175972', 'c175975', 'c175984', 'c176168', 'c176543', 'c176644', 'c176908', 'c177031', 'c177083', 'c177096', 'c177134', 'c177194', 'c177240', 'c177378', 'c177516', 'c177731', 'c177983', 'c178058', 'c178242', 'c178256', 'c178258', 'c178303', 'c178317', 'c178369', 'c178371', 'c178462', 'c178463', 'c178464', 'c178465', 'c178466', 'c178467', 'c178468', 'c178469', 'c178470', 'c178525', 'c178645', 'c178680', 'c178682', 'c178812', 'c179114', 'c179234', 'c179319', 'c179327', 'c179752', 'c179891', 'c179971', 'c180247', 'c180302', 'c180348', 'c180352', 'c180493', 'c180546', 'c180732', 'c180924', 'c180966', 'c181191', 'c181305', 'c181313', 'c181317', 'c181321', 'c181616', 'c181865', 'c182018', 'c182034', 'c182035', 'c182039', 'c182041', 'c182053', 'c182054', 'c182058', 'c182062', 'c182066', 'c182082', 'c182084', 'c182086', 'c182087', 'c182088', 'c182105', 'c182125', 'c182133', 'c182135', 'c182757', 'c183151', 'c183156', 'c183348', 'c183388', 'c183393', 'c183394', 'c183395', 'c183396', 'c183397', 'c183398', 'c183419', 'c183445', 'c183706', 'c183707', 'c183708', 'c183709', 'c183717', 'c183721', 'c183722', 'c183723', 'c183726', 'c183749', 'c183750', 'c183752', 'c183764', 'c183769', 'c183773', 'c183774', 'c183775', 'c183782', 'c183783', 'c183784', 'c183785', 'c183786', 'c183787', 'c183789', 'c183947', 'c183969', 'c183973', 'c183992', 'c184111', 'c184119', 'c184141', 'c184149', 'c184182', 'c184225', 'c184266', 'c184284', 'c184296', 'c184353', 'c184379', 'c184470', 'c184507', 'c184862', 'c184979', 'c185078', 'c185079', 'c185244', 'c185245', 'c185247', 'c185249', 'c185251', 'c185320', 'c185323', 'c185325', 'c185326', 'c185328', 'c185394', 'c185415', 'c185486', 'c185487', 'c185488', 'c185489', 'c185490', 'c185491', 'c185492', 'c185493', 'c185494', 'c185495', 'c185496', 'c185497', 'c185498', 'c185499', 'c185879', 'c185880', 'c185881', 'c185882', 'c185883', 'c185884', 'c185885', 'c186128', 'c186206', 'c186207', 'c186208', 'c186209', 'c186218', 'c186223', 'c186269', 'c186271', 'c186272', 'c186287', 'c186288', 'c186295', 'c186308', 'c186414', 'c186423', 'c186430', 'c186431', 'c186446', 'c186448', 'c186449', 'c186451', 'c186455', 'c186458', 'c186485', 'c186487', 'c186495', 'c186501', 'c186529', 'c186530', 'c186565', 'c186615', 'c186618', 'c186708', 'c186715', 'c186777', 'c186934', 'c186936', 'c186941', 'c186942', 'c186943', 'c186985', 'c187014', 'c187025', 'c187026', 'c187072', 'c187123', 'c187140', 'c187152', 'c187153', 'c187156', 'c187158', 'c187160', 'c187162', 'c187164', 'c187166', 'c187168', 'c187170', 'c187172', 'c187174', 'c187179', 'c187182', 'c187190', 'c187192', 'c187194', 'c187196', 'c187198', 'c187200', 'c187201', 'c187203', 'c187204', 'c187205', 'c187206', 'c187207', 'c187208', 'c187209', 'c187210', 'c187211', 'c187212', 'c187250', 'c187251', 'c187258', 'c187275', 'c187352', 'c187406', 'c187598', 'c187626', 'c187686', 'c187731', 'c187760', 'c187763', 'c187791', 'c187806', 'c187807', 'c187815', 'c187865', 'c187881', 'c187882', 'c187896', 'c187903', 'c187929', 'c187934', 'c187935', 'c187937', 'c187948', 'c187969', 'c188008', 'c188043', 'c188056', 'c188059', 'c188060', 'c188074', 'c188083', 'c188097', 'c188098', 'c188508', 'c188537', 'c188557', 'c188561', 'c188637', 'c188650', 'c188653', 'c188684', 'c188686', 'c188687', 'c188695', 'c188698', 'c188699', 'c188706', 'c188718', 'c188773', 'c188801', 'c188810', 'c188841', 'c188844', 'c188845', 'c188857', 'c188858', 'c188859', 'c188861', 'c188862', 'c188863', 'c188864', 'c188865', 'c188866', 'c188867', 'c188910', 'c188929', 'c188944', 'c188947', 'c188948', 'c188959', 'c188968', 'c188970', 'c188977', 'c188982', 'c188994', 'c189061', 'c189132', 'c189133', 'c189135', 'c189143', 'c189155', 'c189175', 'c189186', 'c189224', 'c189225', 'c189277', 'c189299', 'c189401', 'c189416', 'c189436', 'c189441', 'c189474', 'c189510', 'c189557', 'c189577', 'c189596', 'c189667', 'c189669', 'c189673', 'c189719', 'c189734', 'c189745', 'c189755', 'c189757', 'c189765', 'c189769', 'c189770', 'c189774', 'c189794', 'c189801', 'c189816', 'c189819', 'c189828', 'c189831', 'c189840', 'c189887', 'c189911', 'c189917', 'c189933', 'c189937', 'c189942', 'c189944', 'c189945', 'c189949', 'c189956', 'c189964', 'c189970', 'c189973', 'c189981', 'c189983', 'c189986', 'c189988', 'c189989', 'c189991', 'c189992', 'c189993', 'c189996', 'c189997', 'c189999', 'c190000', 'c190006', 'c190020', 'c190044', 'c190048', 'c190049', 'c190050', 'c190052', 'c190053', 'c190054', 'c190055', 'c190056', 'c190057', 'c190058', 'c190059', 'c190062', 'c190063', 'c190065', 'c190068', 'c190070', 'c190071', 'c190074', 'c190075', 'c190076', 'c190077', 'c190078', 'c190079', 'c190081', 'c190082', 'c190083', 'c190085', 'c190087', 'c190088', 'c190089', 'c190090', 'c190091', 'c190092', 'c190093', 'c190095', 'c190096', 'c190098', 'c190099', 'c190100', 'c190102', 'c190105', 'c190106', 'c190108', 'c190111', 'c190112', 'c190113', 'c190114', 'c190115', 'c190116', 'c190117', 'c190119', 'c190120', 'c190122', 'c190123', 'c190124', 'c190125', 'c190126', 'c190127', 'c190129', 'c190131', 'c190132', 'c190133', 'c190134', 'c190135', 'c190136', 'c190137', 'c190138', 'c190139', 'c190142', 'c190144', 'c190145', 'c190146', 'c190147', 'c190148', 'c190149', 'c190151', 'c190153', 'c190154', 'c190155', 'c190156', 'c190157', 'c190238', 'c190240', 'c190243', 'c190244', 'c190245', 'c190247', 'c190250', 'c190385', 'c190395', 'c190396', 'c190431', 'c190432', 'c190433', 'c190434', 'c190435', 'c190436', 'c190437', 'c190439', 'c190440', 'c190441', 'c190442', 'c190443', 'c190444', 'c190446', 'c190448', 'c190449', 'c190450', 'c190451', 'c190452', 'c190453', 'c190454', 'c190455', 'c190456', 'c190457', 'c190458', 'c190459', 'c190460', 'c190461', 'c190462', 'c190463', 'c190465', 'c190466', 'c190467', 'c190468', 'c190469', 'c190473', 'c190474', 'c190475', 'c190476', 'c190477', 'c190478', 'c190480', 'c190481', 'c190482', 'c190483', 'c190484', 'c190485', 'c190486', 'c190487', 'c190488', 'c190491', 'c190492', 'c190493', 'c190502', 'c190505', 'c190511', 'c190512', 'c190513', 'c190514', 'c190515', 'c190516', 'c190518', 'c190519', 'c190520', 'c190521', 'c190522', 'c190523', 'c190524', 'c190525', 'c190526', 'c190527', 'c190528', 'c190529', 'c190530', 'c190531', 'c190532', 'c190533', 'c190534', 'c190535', 'c190536', 'c190537', 'c190538', 'c190539', 'c190540', 'c190541', 'c190542', 'c190543', 'c190544', 'c190545', 'c190546', 'c190547', 'c190548', 'c190549', 'c190550', 'c190551', 'c190552', 'c190553', 'c190554', 'c190555', 'c190556', 'c190557', 'c190558', 'c190559', 'c190560', 'c190561', 'c190562', 'c190563', 'c190564', 'c190565', 'c190566', 'c190567', 'c190568', 'c190569', 'c190570', 'c190571', 'c190572', 'c190573', 'c190574', 'c190575', 'c190576', 'c190577', 'c190578', 'c190579', 'c190580', 'c190581', 'c190582', 'c190583', 'c190584', 'c190585', 'c190586', 'c190587', 'c190588', 'c190589', 'c190590', 'c190591', 'c190592', 'c190593', 'c190594', 'c190595', 'c190596', 'c190597', 'c190598', 'c190599', 'c190600', 'c190601', 'c190602', 'c190603', 'c190604', 'c190605', 'c190606', 'c190607', 'c190608', 'c190611', 'c190613', 'c190615', 'c190617', 'c190619', 'c190621', 'c190623', 'c190625', 'c190628', 'c190859', 'c190860', 'c190861', 'c190863', 'c190864', 'c190865', 'c190866', 'c190867', 'c190868', 'c190869', 'c190870', 'c190871', 'c190872', 'c190873', 'c190874', 'c190875', 'c190876', 'c190877', 'c190878', 'c190880', 'c190881', 'c190884', 'c190887', 'c190888', 'c190889', 'c190890', 'c190891', 'c190892', 'c190893', 'c190894', 'c190895', 'c190896', 'c190897', 'c190898', 'c190899', 'c190900', 'c190901', 'c190902', 'c190903', 'c190904', 'c190905', 'c190906', 'c190907', 'c190908', 'c190910', 'c190911', 'c190912', 'c190913', 'c190914', 'c190915', 'c190916', 'c190917', 'c190918', 'c190920', 'c190921', 'c190922', 'c190923', 'c190925', 'c190926', 'c190931', 'c190932', 'c190933', 'c190934', 'c190935', 'c190936', 'c190937', 'c190938', 'c190939', 'c190940', 'c190941', 'c190942', 'c190943', 'c190944', 'c190945', 'c190946', 'c190947', 'c190948', 'c190949', 'c190950', 'c190951', 'c190952', 'c190953', 'c190954', 'c190955', 'c190956', 'c190957', 'c190958', 'c190959', 'c190960', 'c190961', 'c190963', 'c190964', 'c190965', 'c190966', 'cj100540', 'e002744', 'e002791', 'e003892', 'e003946', 'e003970', 'e003981', 'e004073', 'e004314', 'e004388', 'e004393', 'e004552', 'e004587', 'e004590', 'e004597', 'e004696', 'e004703', 'e004710', 'e004861', 'e004862', 'e004870', 'e004877', 'e004945', 'e005773', 'e005774', 'e005961', 'e005962', 'e005963', 'e006246', 'e006260', 'e006278', 'e006378', 'e006478', 'e006558', 'e006585', 'e006761', 'e006902', 'e006935', 'e006984', 'e007049', 'e007062', 'e007077', 'e007148', 'e007257', 'e007363', 'e007385', 'e007386', 'e007411', 'e007439', 'e007642', 'e008074', 'e008109', 'e008303', 'e008341', 'e008349', 'e008455', 'e008638', 'e008644', 'e010000', 'e010033', 'e010232', 'e010244', 'e010256', 'e010733', 'e010739', 'e010747', 'e011183', 'e011206', 'e011302', 'e011603', 'e012640', 'e013105', 'e013728', 'e013945', 'e014012', 'e014377', 'e014416', 'e014555', 'e014812', 'e014971', 'e015100', 'e015300', 'e015348', 'e015391', 'e015549', 'e015816', 'e015856', 'e015928', 'e016101', 'e016301', 'e016324', 'e016332', 'e016369', 'e016616', 'e016664', 'e016667', 'e016725', 'e016972', 'e016981', 'e016988', 'e016997', 'e017012', 'e017053', 'e017056', 'e017058', 'e017059', 'e017075', 'e017214', 'e017263', 'e017294', 'e017296', 'e017297', 'e017298', 'e017353', 'e017470', 'e017477', 'e017478', 'e017569', 'e017584', 'e017621', 'e017622', 'e017623', 'e017638', 'e017834', 'e017903', 'e017940', 'e017949', 'e017952', 'e017972', 'e017984', 'e018109', 'e018110', 'e018195', 'e018212', 'e018214', 'e018222', 'e018236', 'e018592', 'e018593', 'e018599', 'e018823', 'e018936', 'e019008', 'e019065', 'e019066', 'e019085', 'e019104', 'e019196', 'e019203', 'e019297', 'e019325', 'e019385', 'e019399', 'e019443', 'e019627', 'e019651', 'e019662', 'e019666', 'e019697', 'e019702', 'e019704', 'e019708', 'e019710', 'e019711', 'e019713', 'e019717', 'e019728', 'e019736', 'e019743', 'e019746', 'e019747', 'e019751', 'e019960', 'e020517', 'e020521', 'e020899', 'e021223', 'e021226', 'e021242', 'e021263', 'e021489', 'e021613', 'e021714', 'e021716', 'e021718', 'e021720', 'e021722', 'e023505', 'e023506', 'e023507', 'e023508', 'e023693', 'e023706', 'e023749', 'e023751', 'e023760', 'e023839', 'e023848', 'e023864', 'e024150', 'e024405', 'e024492', 'e024510', 'e024511', 'e024541', 'e024576', 'e024681', 'e024695', 'e024732', 'e024734', 'e024934', 'e024936', 'e024937', 'e025041', 'e025087', 'e025088', 'e025089', 'e025090', 'e025091', 'e025092', 'e025120', 'e025143', 'e025145', 'e025232', 'e025294', 'e025295', 'e025296', 'e025297', 'e025298', 'e025299', 'e025300', 'e025379', 'e025380', 'e025381', 'e025382', 'e025383', 'e025384', 'e025386', 'e025387', 'e025388', 'e025540', 'e025639', 'e025640', 'e025774', 'e025792', 'e025793', 'e026133', 'e026167', 'e026495', 'e026905', 'e026969', 'e026982', 'e026988', 'e026996', 'e026999', 'e027000', 'e027001', 'e027004', 'e027005', 'e027006', 'e027010', 'e027062', 'e027085', 'e027197', 'e027198', 'e027384', 'e027406', 'e027408', 'e027410', 'e027412', 'e027414', 'e027416', 'e027418', 'e027420', 'e027428', 'e027429', 'e027430', 'e027431', 'e027432', 'e027433', 'e027436']
model = attempt_load(WEIGHTS, map_location=DEVICE)
#======================================================預測圖片登陸號方法
def predict(image, image_size=640):
    image = np.asarray(image)
    
    # Resize image to the inference size
    ori_h, ori_w = image.shape[:2]
    image = cv2.resize(image, (image_size, image_size))
    
    # Transform image from numpy to torch format
    image_pt = torch.from_numpy(image).permute(2, 0, 1).to(DEVICE)
    image_pt = image_pt.float() / 255.0
    
    # Infer
    with torch.no_grad():
        pred = model(image_pt[None], augment=False)[0]
    
    # NMS
    pred = non_max_suppression(pred)[0].cpu().numpy()
    
    # Resize boxes to the original image size
    pred[:, [0, 2]] *= ori_w / image_size
    pred[:, [1, 3]] *= ori_h / image_size
    
    return pred


#======================================================啟動預測圖片登陸號方法
def yolov7dectcout(IMAGE_FILE):
    
    image = Image.open(IMAGE_FILE)

    pred = predict(image)
    draw = ImageDraw.Draw(image)
    for x1, y1, x2, y2, conf, class_id in pred:
        draw.rectangle(((x1, y1), (x2, y2)), width=2)
        draw.text((x1, y1), CLASSES[int(class_id)])
    draw = ImageDraw.Draw(image)
    for x1, y1, x2, y2, conf, class_id in pred:
        text = f"{CLASSES[int(class_id)]}  {conf:.2f}"
        draw.rectangle(((x1, y1), (x2, y2)), width=2)
        draw.text((x1, y1), text)
        
    try:
        return CLASSES[int(class_id)]
    except:
        return 'Null'

#======================================================輸入圖片路徑
IMAGE_FILE = "./exp/a1.jpg"
yolov7dectcout(IMAGE_FILE)
#print(dectcout(IMAGE_FILE))